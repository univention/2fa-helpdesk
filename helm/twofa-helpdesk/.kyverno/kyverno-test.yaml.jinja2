## SPDX-FileCopyrightText: 2024 Bundesministerium des Innern und für Heimat, PG ZenDiS "Projektgruppe für Aufbau ZenDiS"
## SPDX-License-Identifier: Apache-2.0
---
apiVersion: "cli.kyverno.io/v1alpha1"
kind: "Test"
metadata:
  name: "nubus-test"
policies:
  - "{{ policies_base_path }}/disallow-container-sock-mounts.yaml"
  - "{{ policies_base_path }}/disallow-default-serviceaccount.yaml"
  - "{{ policies_base_path }}/disallow-host-namespaces.yaml"
  - "{{ policies_base_path }}/disallow-host-path.yaml"
  - "{{ policies_base_path }}/disallow-host-ports.yaml"
  - "{{ policies_base_path }}/disallow-host-process.yaml"
  - "{{ policies_base_path }}/disallow-latest-tag.yaml"
  - "{{ policies_base_path }}/require-containersecuritycontext.yaml"
  - "{{ policies_base_path }}/require-health-and-liveness-check.yaml"
  - "{{ policies_base_path }}/require-imagepullpolicy.yaml"
  - "{{ policies_base_path }}/require-requests-limits.yaml"
  - "{{ policies_base_path }}/require-tag-and-digest.yaml"
  - "{{ policies_base_path }}/template-image-registries.yaml"
  - "{{ policies_base_path }}/template-ingress.yaml"
  - "{{ policies_base_path }}/template-replicas.yaml"
  - "{{ policies_base_path }}/template-require-imagepullsecets.yaml"
  - "{{ policies_base_path }}/template-storage.yaml"
resources:
  - "manifest.yaml"
results:
# Frontend
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-tag-and-digest"
    kind: "Deployment"
    rule: "require-tag-and-digest"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-default-serviceaccount"
    kind: "Deployment"
    rule: "disallow-default-serviceAccountName"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "template-imagepullsecrets"
    kind: "Deployment"
    rule: "template-imagePullSecrets"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-latest-tag"
    kind: "Deployment"
    rule: "disallow-latest-tag"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-latest-tag"
    kind: "Deployment"
    rule: "require-image-tag-or-digest"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-imagepullpolicy"
    kind: "Deployment"
    rule: "require-imagePullPolicy"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-health-and-liveness-check"
    kind: "Deployment"
    rule: "require-health-and-liveness-check"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-requests-limits"
    kind: "Deployment"
    rule: "validate-resources"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "template-image-registries"
    kind: "Deployment"
    rule: "template-image-registries"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-ro-rootfs"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-no-privilege-escalation"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-all-capabilities-dropped"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-no-privileged"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-run-as-user"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-run-as-group"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-seccomp-profile"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-run-as-non-root"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-empty-seLinuxOptions"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-default-procMount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "restrict-sysctls"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-container-sock-mounts"
    kind: "Deployment"
    rule: "validate-docker-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-container-sock-mounts"
    kind: "Deployment"
    rule: "validate-containerd-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-container-sock-mounts"
    kind: "Deployment"
    rule: "validate-crio-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-container-sock-mounts"
    kind: "Deployment"
    rule: "validate-dockerd-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-host-namespaces"
    kind: "Deployment"
    rule: "disallow-host-namespaces"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-host-path"
    kind: "Deployment"
    rule: "disallow-host-path"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-host-ports"
    kind: "Deployment"
    rule: "disallow-host-ports"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "disallow-host-process"
    kind: "Deployment"
    rule: "disallow-host-process"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-ui"
    policy: "template-replicas"
    kind: "Deployment"
    rule: "template-replicas"
    result: "pass"
# Backend
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-tag-and-digest"
    kind: "Deployment"
    rule: "require-tag-and-digest"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-default-serviceaccount"
    kind: "Deployment"
    rule: "disallow-default-serviceAccountName"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "template-imagepullsecrets"
    kind: "Deployment"
    rule: "template-imagePullSecrets"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-latest-tag"
    kind: "Deployment"
    rule: "disallow-latest-tag"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-latest-tag"
    kind: "Deployment"
    rule: "require-image-tag-or-digest"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-imagepullpolicy"
    kind: "Deployment"
    rule: "require-imagePullPolicy"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-health-and-liveness-check"
    kind: "Deployment"
    rule: "require-health-and-liveness-check"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-requests-limits"
    kind: "Deployment"
    rule: "validate-resources"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "template-image-registries"
    kind: "Deployment"
    rule: "template-image-registries"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-ro-rootfs"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-no-privilege-escalation"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-all-capabilities-dropped"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-no-privileged"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-run-as-user"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-run-as-group"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-seccomp-profile"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-run-as-non-root"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-empty-seLinuxOptions"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "require-default-procMount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "require-containersecuritycontext"
    kind: "Deployment"
    rule: "restrict-sysctls"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-container-sock-mounts"
    kind: "Deployment"
    rule: "validate-docker-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-container-sock-mounts"
    kind: "Deployment"
    rule: "validate-containerd-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-container-sock-mounts"
    kind: "Deployment"
    rule: "validate-crio-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-container-sock-mounts"
    kind: "Deployment"
    rule: "validate-dockerd-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-host-namespaces"
    kind: "Deployment"
    rule: "disallow-host-namespaces"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-host-path"
    kind: "Deployment"
    rule: "disallow-host-path"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-host-ports"
    kind: "Deployment"
    rule: "disallow-host-ports"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "disallow-host-process"
    kind: "Deployment"
    rule: "disallow-host-process"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk"
    policy: "template-replicas"
    kind: "Deployment"
    rule: "template-replicas"
    result: "pass"
# Ingress frontend
  - resources:
      - "release-name-twofa-helpdesk-twofa-helpdesk-ui"
    policy: "template-ingress"
    kind: "Ingress"
    rule: "template-ingressClassName"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-twofa-helpdesk-ui"
    policy: "template-ingress"
    kind: "Ingress"
    rule: "template-tls-secretName"
    result: "pass"
# Ingress backend
  - resources:
      - "release-name-twofa-helpdesk-twofa-backend"
    policy: "template-ingress"
    kind: "Ingress"
    rule: "template-ingressClassName"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-twofa-backend"
    policy: "template-ingress"
    kind: "Ingress"
    rule: "template-tls-secretName"
    result: "pass"
# Provisioning Job
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-tag-and-digest"
    kind: "Job"
    rule: "require-tag-and-digest"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-default-serviceaccount"
    kind: "Job"
    rule: "disallow-default-serviceAccountName"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "template-imagepullsecrets"
    kind: "Job"
    rule: "template-imagePullSecrets"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-latest-tag"
    kind: "Job"
    rule: "disallow-latest-tag"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-latest-tag"
    kind: "Job"
    rule: "require-image-tag-or-digest"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-imagepullpolicy"
    kind: "Job"
    rule: "require-imagePullPolicy"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-requests-limits"
    kind: "Job"
    rule: "validate-resources"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "template-image-registries"
    kind: "Job"
    rule: "template-image-registries"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-ro-rootfs"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-no-privilege-escalation"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-all-capabilities-dropped"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-no-privileged"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-run-as-user"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-run-as-group"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-seccomp-profile"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-run-as-non-root"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-empty-seLinuxOptions"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "require-default-procMount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "require-containersecuritycontext"
    kind: "Job"
    rule: "restrict-sysctls"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-container-sock-mounts"
    kind: "Job"
    rule: "validate-docker-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-container-sock-mounts"
    kind: "Job"
    rule: "validate-containerd-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-container-sock-mounts"
    kind: "Job"
    rule: "validate-crio-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-container-sock-mounts"
    kind: "Job"
    rule: "validate-dockerd-sock-mount"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-host-namespaces"
    kind: "Job"
    rule: "disallow-host-namespaces"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-host-path"
    kind: "Job"
    rule: "disallow-host-path"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-host-ports"
    kind: "Job"
    rule: "disallow-host-ports"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "disallow-host-process"
    kind: "Job"
    rule: "disallow-host-process"
    result: "pass"
  - resources:
      - "release-name-twofa-helpdesk-1-provisioning"
    policy: "template-replicas"
    kind: "Job"
    rule: "template-replicas"
    result: "pass"