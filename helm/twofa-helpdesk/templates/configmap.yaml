---
apiVersion: "v1"
kind: ConfigMap
metadata:
  name: {{ printf "%s-config" (include "common.names.fullname" .) }}
  namespace: {{ include "common.names.namespace" . | quote }}
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
    {{- if .Values.twofaHelpdeskBackend.extraLabels }}
    {{- include "common.tplvalues.render" ( dict "value" .Values.twofaHelpdeskBackend.extraLabels "context" . ) | nindent 4 }}
    {{- end }}
  {{- if .Values.twofaHelpdeskBackend.extraAnnotations }}
  annotations: {{- include "common.tplvalues.render" ( dict "value" .Values.twofaHelpdeskBackend.extraAnnotations "context" . ) | nindent 4 }}
  {{- end }}
data:
  OIDC_HOST: "{{ .Values.twofaHelpdeskBackend.config.oidc_host }}"
  OIDC_REALM: "{{ .Values.twofaHelpdeskBackend.config.oidc_realm }}"
  OIDC_CLIENT_ID: "{{ .Values.twofaHelpdeskBackend.config.oidc_client }}"

  UDM_USERNAME: ""
  UDM_PASSWORD: ""
  UDM_HOST: "http://ums-udm-rest-api:9979" # FIXME

  # Keycloak configuration
  KEYCLOAK_URL: "{{ .Values.twofaHelpdeskBackend.config.keycloak_url }}"
  KEYCLOAK_USERNAME: "{{ .Values.twofaHelpdeskBackend.config.keycloak_admin_user }}"
  KEYCLOAK_REALM_NAME: "{{ .Values.twofaHelpdeskBackend.config.keycloak_user_realm }}"
  KEYCLOAK_ADMIN_REALM_NAME: master

  TWOFA_ADMIN_GROUPS: {{ join "," .Values.twofaHelpdeskBackend.config.twofa_admin_groups }}

  PREFIX: "/backend"

  VITE_API_URL: /backend
  VITE_API_TOKEN: test
  VITE_KEYCLOAK_URL: "{{ .Values.twofaHelpdeskBackend.config.keycloak_url }}"
  VITE_KEYCLOAK_REALM: "{{ .Values.twofaHelpdeskBackend.config.keycloak_user_realm }}"
  VITE_KEYCLOAK_CLIENT_ID: "chrissytest"
...
